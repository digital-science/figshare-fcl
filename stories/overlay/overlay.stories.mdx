import { useState, useMemo } from "react";
import { Meta, Canvas, Story, ArgsTable } from "@storybook/addon-docs/blocks";
import {Button} from '@figshare/ui/button';
import {Input} from '@figshare/ui/input';
import { Overlay, OverlayHeader, OverlayFooter, OverlayContent } from "@figshare/ui/overlay";
import Toggletip, { Trigger, Content, UncontrolledToggletip } from "@figshare/ui/toggletip";

import style from './overlay.stories.css';

export const MoreContent = () => {
  const content = useMemo(() =>  (Array.from(new Array(20), (v, i) => 
      (<p key={i}>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.</p>))),[]);
  return (<>
            <p>Scroll down...</p>
            {content}
            <p>Done.</p>
          </>);
}

export const Example = ({ children }) => {
  const [opened, setOpened] = useState("");
  const [more, setMore] = useState(false);
  const overlays = React.Children.toArray(children);
  return (<>
          <div className={style.buttons}>
            <Button onClick={() => setOpened("primary-overlay")}>Open Overlay</Button>
            <Button onClick={() => setOpened("form-overlay")}>Open Form Overlay</Button>
            <Button onClick={() => setOpened("warning-overlay")}>Open Warning</Button>
          </div>
          <Overlay isVisible={opened.includes("primary-overlay")} onClose={() => setOpened("")}>
            <OverlayHeader title="Overlay Title" description="Overlay description" />
            <OverlayContent>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.</p>
              <Button onClick={() => setOpened("primary-overlay warning-overlay")}>Open Warning Overlay</Button>
              <br />
              <Button onClick={() => setOpened("primary-overlay form-overlay")}>Open Form Overlay</Button>
              <br />
              <Input type="date" onChange={() => undefined} />
              <br />
              <UncontrolledToggletip>
                <Trigger>
                  Popup
                </Trigger>
                <Content>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.
                  <button>Focusable element</button>
                  Morbi tincidunt posuere leo. Maecenas eu justo imperdiet, tempor magna at, tempus dui. Quisque ante augue,
                  <input value="static value, but focusable element" />
                  pellentesque venenatis commodo et, viverra et lectus. Etiam id vehicula dui. Quisque ac massa faucibus,
                </Content>
              </UncontrolledToggletip>
            </OverlayContent>
            <OverlayFooter>
              <Button theme="tertiary" onClick={() => setOpened("")}>Close</Button>
              <Button theme="primary" onClick={() => setOpened("")}>Confirm</Button>
            </OverlayFooter>
          </Overlay>
          <Overlay background="warning" isVisible={opened.includes("warning-overlay")} onClose={() => setOpened(o => o.replace("warning-overlay", ""))}>
            <OverlayHeader title="Overlay Title" description="Overlay description" />
            <OverlayContent>
              <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.</p>
              <Button theme="primary">Button</Button>
              <br />
              <Input type="date" onChange={() => undefined} />
            </OverlayContent>
            <OverlayFooter>
              <Button theme="primary" onClick={() => setOpened(o => o.replace("warning-overlay", ""))}>Close</Button>
            </OverlayFooter>
          </Overlay>
          <Overlay background="primary" variant="formModal" isVisible={opened.includes("form-overlay")} onClose={() => setOpened(o => o.replace("form-overlay", ""))}>
            <OverlayContent>
              <OverlayHeader isPartOfContent={true} title="Form Overlay Title" description="Wide overlay that covers the whole viewport height wise." />
              <p>Click on the More button to make the content scrollable.<br/>You can render OverlayHeader inside OverlayContent to allow it to scroll with the content, and the component can be customised for this case by setting the isPartOfContent property to true.<br/>Check the Example code or PropsTable in the docs section.</p>
              <br />
              <Button theme="primary" onClick={() => setMore(m => !m)}>More</Button>
              <br />
              {more && <MoreContent />}
            </OverlayContent>
            <OverlayFooter>
              <Button theme="primary" onClick={() => setOpened(o => o.replace("form-overlay", ""))}>Close</Button>
            </OverlayFooter>
          </Overlay>
      </>);
}

<Meta 
  component={Overlay} 
  title="UI/Overlay" 
  parameters={{
    viewMode: 'docs',
    previewTabs: { 
      canvas: { hidden: true } 
     },
  }}
/>

# Examples

<Story 
  name="Overlay"
  parameters={{
    docs: { disable: true },
    layout: "centered",
  }}
>
  <Example />
</Story>


<Canvas>
  <Example />
</Canvas>

```jsx
import { Overlay, OverlayHeader, OverlayFooter, OverlayContent } from "@figshare/ui/overlay";

export const MoreContent = () => {
  const content = useMemo(() =>  (Array.from(new Array(20), (v, i) => 
      (<p key={i}>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.</p>))),[]);
  return (<>
            <p>Scroll down...</p>
            {content}
          </>);
}

export const Example = ({ children }) => {
  const [opened, setOpened] = useState("");
  const [more, setMore] = useState(false);
  const overlays = React.Children.toArray(children);
  return (<>
          <div className={style.buttons}>
            <Button onClick={() => setOpened("primary-overlay")}>Open Overlay</Button>
            <Button onClick={() => setOpened("form-overlay")}>Open Form Overlay</Button>
            <Button onClick={() => setOpened("warning-overlay")}>Open Warning</Button>
          </div>
          <Overlay isVisible={opened.includes("primary-overlay")} onClose={() => setOpened("")}>
            <OverlayHeader title="Overlay Title" description="Overlay description" />
            <OverlayContent>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.
              <Button onClick={() => setOpened("primary-overlay warning-overlay")}>Open Warning Overlay</Button>
              <Button onClick={() => setOpened("primary-overlay form-overlay")}>Open Form Overlay</Button>
              <Input type="date" onChange={() => undefined} />
              <UncontrolledToggletip>
                <Trigger>
                  Popup
                </Trigger>
                <Content>
                  Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.
                  <button>Focusable element</button>
                  Morbi tincidunt posuere leo. Maecenas eu justo imperdiet, tempor magna at, tempus dui. Quisque ante augue,
                  <input value="static value, but focusable element" />
                  pellentesque venenatis commodo et, viverra et lectus. Etiam id vehicula dui. Quisque ac massa faucibus,
                </Content>
              </UncontrolledToggletip>
            </OverlayContent>
            <OverlayFooter>
              <Button theme="tertiary" onClick={() => setOpened("")}>Close</Button>
              <Button theme="primary" onClick={() => setOpened("")}>Confirm</Button>
            </OverlayFooter>
          </Overlay>
          <Overlay background="warning" isVisible={opened.includes("warning-overlay")} onClose={() => setOpened(o => o.replace("warning-overlay", ""))}>
            <OverlayHeader title="Overlay Title" description="Overlay description" />
            <OverlayContent>
              Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent at turpis quis nisi sollicitudin cursus.
              <Button theme="primary">Button</Button>
              <Input type="date" onChange={() => undefined} />
            </OverlayContent>
            <OverlayFooter>
              <Button theme="primary" onClick={() => setOpened(o => o.replace("warning-overlay", ""))}>Close</Button>
            </OverlayFooter>
          </Overlay>
          <Overlay background="primary" variant="formModal" isVisible={opened.includes("form-overlay")} onClose={() => setOpened(o => o.replace("form-overlay", ""))}>
            <OverlayContent>
              <OverlayHeader isPartOfContent={true} title="Form Overlay Title" description="Wide overlay that covers the whole viewport height wise." />
              <p>Click on the More button to make the content scrollable.<br/>You can render OverlayHeader inside OverlayContent to allow it to scroll with the content, and the component can be customised for this case by setting the isPartOfContent property to true.<br/>Check the Example code or PropsTable in the docs section.</p>
              <Button theme="primary" onClick={() => setMore(m => !m)}>More</Button>
              {more && <MoreContent />}
            </OverlayContent>
            <OverlayFooter>
              <Button theme="primary" onClick={() => setOpened(o => o.replace("form-overlay", ""))}>Close</Button>
            </OverlayFooter>
          </Overlay>
      </>);
}

<Example />
```

## Props Tables

### Overlay
<ArgsTable of={Overlay} />

### OverlayHeader
<ArgsTable of={OverlayHeader} />

### OverlayFooter
<ArgsTable of={OverlayFooter} />

### OverlayContent
<ArgsTable of={OverlayContent} />